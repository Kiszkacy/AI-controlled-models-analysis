name: Python linters


on:
  workflow_run:
    workflows: ["Build"]
    types:
      - completed


jobs:
  ruff:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4

    - name: Python setup
      id: python-setup
      uses: actions/setup-python@v5
      with:
        python-version: ${{ env.PYTHON_VERSION }}

    - name: Load cached virtual environment
      uses: actions/cache/restore@v3
      with:
        path: ./.venv/
        key: ${{ runner.os }}-${{ steps.python-setup.outputs.python-version }}-venv-${{ hashFiles('core/requirements.txt') }}

    - name: ruff
      run: |
        source ./.venv/bin/activate
        ruff check core --verbose --output-format=github


  mypy:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4

    - name: Python setup
      id: python-setup
      uses: actions/setup-python@v5
      with:
        python-version: ${{ env.PYTHON_VERSION }}

    - name: Load cached virtual environment
      uses: actions/cache/restore@v3
      with:
        path: ./.venv/
        key: ${{ runner.os }}-${{ steps.python-setup.outputs.python-version }}-venv-${{ hashFiles('core/requirements.txt') }}

    - name: mypy
      run: |
        source ./.venv/bin/activate
        mypy core --show-error-codes --pretty --show-column-numbers --show-error-context
 